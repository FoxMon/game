package client;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.Socket;
import java.net.URL;
import java.util.List;
import java.util.Set;

import javax.swing.ImageIcon;
import javax.swing.JFrame;
import javax.swing.JOptionPane;
import javax.swing.ListCellRenderer;

import common.Account;
import common.Message;
import common.Room;
import clientPanel.InviteUsetListFrame;
import clientPanel.MessageListFrame;
import clientPanel.MusicChoicePanel;
import game.GameFrame;

public class ClientNetwork extends Thread {
	private Socket soc; // socket
	private ObjectOutputStream oos = null;
	private ObjectInputStream ois = null;

	private DatagramSocket ds; // subsocket
	private ClientUI ui;
	private Account user;
	private String nick;	// user nick

	public ClientNetwork(ClientUI c) {
		this.ui = c;
		
		System.out.println("connectiong...");
		
		try {
			soc = new Socket(c.ip, 56789);
			
			System.out.println("trying...");
			
			oos = new ObjectOutputStream(soc.getOutputStream());
			ois = new ObjectInputStream(soc.getInputStream());
			System.out.println("[client] connected to server");
			ds = new DatagramSocket(soc.getLocalPort()); // // TCP/UDP

		} catch (IOException e) {
			System.out.println("[client] network error " + e.toString());
		}
		start();
	}

	@Override
	public void run() {
		while (!ds.isClosed()) {
			DatagramPacket dp = new DatagramPacket(new byte[2048], 2048);
			try {
				ds.receive(dp);
				System.out.println("client UDP received");
				String data = new String(dp.getData(), 0, dp.getLength());
				System.out.println(data);
				String[] str = data.split("#");
				switch (str[0]) {
				case "userListChange":	// login user list
					sendUserListRequest();
					break;
				case "changerooms":		// room list update
					sendStateRoomRequest();
					break;
				case "changechat":		// message
					System.out.println(str[1]);
					String txt = str[1];
					ui.pnMusicChoice.txArea.append(txt + "\n");
					break;
				case "readysuccess":	// ready
					System.out.println("諛쏆쓬");
					ui.pnMusicChoice.p.leftButton.setEnabled(false);
					ui.pnMusicChoice.p.rightButton.setEnabled(false);
					ui.pnMusicChoice.btReady.setEnabled(false);
					ui.pnMusicChoice.btStart.setEnabled(true);
					ui.pnMusicChoice.btRoomSetting.setEnabled(false);
					break;
				case "readycancel":		// cancel
					ui.pnMusicChoice.p.leftButton.setEnabled(true);
					ui.pnMusicChoice.p.rightButton.setEnabled(true);
					ui.pnMusicChoice.btReady.setEnabled(false);
					ui.pnMusicChoice.btStart.setEnabled(false);
					ui.pnMusicChoice.btRoomSetting.setEnabled(false);
					break;
				case "roominfo":	// enter..
					ui.pnMusicChoice.tfusernick2.setText(str[1]);
					ui.pnMusicChoice.tfuserinfo2.setText(str[2]);
					ui.pnMusicChoice.btInvite.setEnabled(false);
					ui.pnMusicChoice.btExpel.setEnabled(true);
					ui.pnMusicChoice.btRoomSetting.setEnabled(false);
					break;
				case "reroominfo":	// out
					ui.pnMusicChoice.tfusernick2.setText("�궗�슜�옄 �뾾�쓬");
					ui.pnMusicChoice.tfuserinfo2.setText("");
					ui.pnMusicChoice.lbCrownRight.setIcon(null);
					ui.pnMusicChoice.lbCrownLeft.setIcon(new ImageIcon(getClass().getClassLoader().getResource("clientPanel/imge/crown1.png")));
					ui.pnMusicChoice.btReady.setEnabled(false);
					ui.pnMusicChoice.btStart.setEnabled(false);
					ui.pnMusicChoice.p.leftButton.setEnabled(true);
					ui.pnMusicChoice.p.rightButton.setEnabled(true);
					ui.pnMusicChoice.btInvite.setEnabled(true);
					ui.pnMusicChoice.btExpel.setEnabled(false);
					ui.pnMusicChoice.btRoomSetting.setEnabled(true);;
					break;
				case "startgame":	// start
					ui.pnMusicChoice.p.isRoomScreen = false;
					GameFrame g = new GameFrame(ui);
					ui.pnMusicChoice.p.selectedMusic.close();
					if(str[2].equals("1")) {
						g.twouser = false;
					} else {
						g.twouser = true;
					}
					g.setLocationRelativeTo(null);
					g.setTitle("Drop the beat!! - Game");
					g.setVisible(true);
					ui.setVisible(false);
					break;
				case "right":	
					System.out.println("right");
					ui.pnMusicChoice.p.selectRight();
					break;
				case "left":	
					ui.pnMusicChoice.p.selectLeft();
					break;
				case "score":	
					String score = str[1];
					GameFrame.game.vsScore = Integer.valueOf(score);
					break;
				case "gameresultSetted":	
					sendReRoomUserInfoRequest();
					break;
				case "sendmessage":			
					sendMessageStateRequest();
					break;
				case "resetmessage":		
					sendShowMessageListRequest();
					break;
				case "invite":				
					int idx = JOptionPane.showConfirmDialog(ui, str[1] + "님이 초대하셨습니다. \n 수락하시겠습니까?" );
					
					if(idx == 0) {
						sendStateRoomRequest();
						if(!(ui.pnRoom.btList.get(Integer.valueOf(str[2])).isEnabled())) {
							JOptionPane.showMessageDialog(ui, "諛⑹씠 苑� 李얠뒿�땲�떎.");
							return;
						}
						sendEnterRoomRequest(Integer.valueOf(str[2]));
					}
					break;
				case "expel":				// 媛뺥눜 �떦�븷 �븣
					sendLeaveRequest();
					JOptionPane.showMessageDialog(ui, "媛뺥눜�떦�븯���뒿�땲�떎.");
					break;
				}
			} catch (IOException e) {
				System.out.println("dp failed .. " + e.toString());
				ds.close();
				break;
			}

		}
	}
	
	// �쉶�썝媛��엯
	public void sendCreateRequest(String nick, String pass, String name, String repass) {
		String resp = null;
		System.out.println(" [client] request : ");
		if (nick.trim().equals("") || pass.trim().equals("")) {
			JOptionPane.showMessageDialog(ui, "�븘�씠�뵒�� 鍮꾨�踰덊샇瑜� �엯�젰�븯�꽭�슂.");
			return;
		}
		if (!pass.equals(repass)) {
			JOptionPane.showMessageDialog(ui, "鍮꾨�踰덊샇瑜� �솗�씤�븯�꽭�슂");
			return;
		}
		if (!ui.pnSignup.rbAgree.isSelected()) {
			JOptionPane.showMessageDialog(ui, "�빟愿��쓣 �씫怨� �룞�쓽�빐二쇱꽭�슂.");
			return;
		}
		synchronized (oos) {
			try {
				oos.writeObject("create#" + nick + "#" + pass + "#" + name);

				resp = (String) ois.readObject();
				System.out.println("[client] response : " + resp);
				String[] data = resp.split("#");

				// �뿬湲곗꽌 ui �젣�뼱.
				if (data[0].equals("true")) {
					ui.pnSignup.tfId.setText(nick);
					ui.pnSignup.tfpw.setText("");
					ui.pnSignup.tfname.setText("");
					ui.pnSignup.tfrpw.setText("");
					JOptionPane.showMessageDialog(ui, "�븘�씠�뵒媛� �깮�꽦�릺�뿀�뒿�땲�떎.");
					// 濡쒓렇�씤 �럹�씠吏�濡� �씠�룞.
					ui.setSize(496, 748);
					ui.setTitle("Drop the beat!! - Login");
					ui.setContentPane(ui.pnLogin);
					ui.pnLogin.tfid.setText(nick);

				} else {
					JOptionPane.showMessageDialog(ui, data[1]);
				}

			} catch (ClassNotFoundException | IOException e) {
				System.out.println("[client] network error " + e.toString());
			}
		}
	}
	
	// 濡쒓렇�씤 �슂泥�
	public void sendLoginRequest(String nick, String pass) {
		this.nick = nick;
		String resp = null;
		System.out.println("[client] request : ");
		if (nick.trim().equals("") || pass.trim().equals("")) {
			JOptionPane.showMessageDialog(ui, "�븘�씠�뵒�� 鍮꾨�踰덊샇瑜� �엯�젰�븯�꽭�슂.");
			return;
		}
		synchronized (oos) {
			try {
				oos.writeObject("join#" + nick + "#" + pass);

				resp = (String) ois.readObject();
				System.out.println("[client] response : " + resp);

				// �뿬湲곗꽌 ui �젣�뼱.
				String[] data = resp.split("#");
				if (data[0].equals("true")) {
					System.out.println("come");
					ui.pnLogin.tfid.setText("");
					ui.pnLogin.tfpw.setText("");
					ui.setSize(800, 800);
					ui.setTitle("Drop the beat!! - Wating Room");
					ui.setLocationRelativeTo(null);
					ui.setContentPane(ui.pnRoom);
					ui.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);
					sendStateRoomRequest();
					sendMessageStateRequest();
				} else {
					ui.pnLogin.tfid.setText("");
					ui.pnLogin.tfpw.setText("");
					JOptionPane.showMessageDialog(ui, data[1]);
				}

			} catch (ClassNotFoundException | IOException e) {
				System.out.println("[client] network error " + e.toString());
			}
		}
	}
	
	// 諛� �굹媛� �븣 or 異붾갑�떦�뻽�쓣 �븣
	public void sendLeaveRequest() {
		String resp = null;
		synchronized (oos) {
			try {
				System.out.println("諛� �굹媛붿쓬.");
				oos.writeObject("leave");
				resp = (String) ois.readObject();
				if (resp == null) {
					ui.setSize(800, 800);
					ui.setTitle("Drop the beat!! - Wating Room");
					ui.setLocationRelativeTo(null);
					ui.setContentPane(ui.pnRoom);
					sendUserListRequest();
					ui.pnMusicChoice.p.selectedMusic.close();
				}
			} catch (ClassNotFoundException | IOException e) {
			}
		}
	}
	
	// 濡쒓렇�씤 �쑀�� 紐⑸줉怨� �궡 �젙蹂� 媛깆떊 or 蹂�寃�
	public void sendUserListRequest() {
		Set<Account> resp = null;
		synchronized (oos) {
			try {
				oos.writeObject("get");
				resp = (Set<Account>) ois.readObject();
				System.out.println(resp);
				String[] ar = new String[resp.size()];
				int i = 0;
				for (Account a : resp) {
					if(a.getNick().equals(nick)) {
						user = a;
						ui.pnRoom.pnInfo.lbId.setText(a.getNick());
						ui.pnRoom.pnInfo.lbState.setText(a.tell());
						
					}
					ar[i++] = a.toString();
				}
				ui.pnRoom.userList.setListData(ar);
			} catch (Exception e) {
				System.out.println(e.toString());
			}

		}
	}
	
	// 諛� 紐⑸줉 遺덈윭�삤湲� or 媛깆떊
	public void sendStateRoomRequest() {
		List<Room> resp = null;
		synchronized (oos) {
			try {
				oos.writeObject("roomlist");
				resp = (List<Room>) ois.readObject();
				int i = 0;
				System.out.println(resp);
				if (!resp.isEmpty()) {
					do {
						System.out.println("猷� !null");
						ui.pnRoom.btList.get(i).setText("");
						ui.pnRoom.btList.get(i).setEnabled(true);
						ui.pnRoom.btList.get(i).setText("<html>�젣紐� : " +resp.get(i).getTitle() + "<br/>" + "諛⑹옣 : " + resp.get(i).getJoiner().get(0).getNick() + "<br/>" + "�씤�썝 : " + resp.get(i).getJoiner().size() + " / 2" + "<br/>" + "�븫�샇諛� : " + (resp.get(i).getPass().equals("") ? "NO" : "YES") + "<br/>" + "諛� �긽�깭 : " + (resp.get(i).isGameStart() ? "寃뚯엫 以�.." : "��湲� 以�..")+  "</html>");               
						if(resp.get(i).getJoiner().size() == 2) {
							ui.pnRoom.btList.get(i).setEnabled(false);
						}
						if(!resp.get(i).isTwoUserRoom()) {
							ui.pnRoom.btList.get(i).setText("<html>�젣紐� : " +resp.get(i).getTitle() + "<br/>" + "諛⑹옣 : " + resp.get(i).getJoiner().get(0).getNick() + "<br/>" + "�씤�썝 : " + resp.get(i).getJoiner().size() + " / 1" + "<br/>" + "�븫�샇諛� : " + (resp.get(i).getPass().equals("") ? "NO" : "YES") + "<br/>" + "諛� �긽�깭 : " + (resp.get(i).isGameStart() ? "寃뚯엫 以�.." : "��湲� 以�..")+  "</html>");               
							ui.pnRoom.btList.get(i).setEnabled(false);
						}
						i++;
					} while (i < resp.size());
				}
				while (i < 8) {
					System.out.println("猷� null");
					ui.pnRoom.btList.get(i).setEnabled(false);
					ui.pnRoom.btList.get(i).setText("");
					i++;
				}

			} catch (ClassNotFoundException | IOException e) {
			}
		}
	}
	
	// 濡쒓렇�븘�썐�떆�뿉 泥섎━�맆 �룞�옉
	public void sendLogoutRequest() {
		boolean resp = false;
		synchronized (oos) {
			try {
				oos.writeObject("logout");
				resp = (Boolean) ois.readObject();
				if (resp == true) {
					JOptionPane.showMessageDialog(ui, "濡쒓렇�븘�썐�릺�뿀�뒿�땲�떎.");
					ui.setSize(496, 748);
					ui.setTitle("Drop the beat!! - Login");
					ui.setLocationRelativeTo(null);
					ui.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
					ui.setContentPane(ui.pnLogin);
				} else {

				}
			} catch (ClassNotFoundException | IOException e) {
			}
		}
	}


	
	// 諛� �엯�옣
	public void sendEnterRoomRequest(int idx) {
		synchronized (oos) {
			try {
				System.out.println("enter" + idx);
				oos.writeObject("enterroom#" + idx);
				Room resp = (Room) ois.readObject();
				if (!(resp == null)) {		// 鍮꾨쾲諛⑹씠 �븘�땲怨� �꽦怨듭떆
					ui.setSize(1400, 730);
					ui.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);
					ui.pnMusicChoice = new MusicChoicePanel(ui);
					ui.setTitle("Drop the beat!! - Room");
					ui.setContentPane(ui.pnMusicChoice);
					sendChatRequest(" �엯�옣�뻽�뒿�땲�떎.");
					ui.pnMusicChoice.lbCrownRight.setIcon(new ImageIcon(getClass().getClassLoader().getResource("clientPanel/imge/crown1.png")));
					ui.pnMusicChoice.btReady.setEnabled(true);
					ui.pnMusicChoice.btStart.setEnabled(false);
					ui.pnMusicChoice.btInvite.setEnabled(false);
					ui.pnMusicChoice.btExpel.setEnabled(false);
					ui.pnMusicChoice.tfusernick2.setText(resp.getJoiner().get(0).getNick());
					ui.pnMusicChoice.tfuserinfo2.setText(resp.getJoiner().get(0).tell());
					ui.pnMusicChoice.tfusernick1.setText(resp.getJoiner().get(1).getNick());
					ui.pnMusicChoice.tfuserinfo1.setText(resp.getJoiner().get(1).tell());
					ui.pnMusicChoice.p.leftButton.setEnabled(false);
					ui.pnMusicChoice.p.rightButton.setEnabled(false);
					sendRoomUserInfoRequest();
					ui.pnMusicChoice.p.selectedMusic.close();
					ui.pnMusicChoice.p.nowSelected = resp.getSelectMusic();
					ui.pnMusicChoice.p.selectTrack(resp.getSelectMusic());
					ui.pnMusicChoice.btRoomSetting.setEnabled(false);
					ui.pnMusicChoice.p.isRoomScreen = true;
					
					} else {		// 鍮꾨쾲諛⑹씪 �븣
						String pw = JOptionPane.showInputDialog("鍮꾨�踰덊샇瑜� �엯�젰�븯�꽭�슂.");
						if (!(pw.equals(""))) {
								oos.writeObject("secretroom#" + pw);
								resp = (Room) ois.readObject();
								if(resp != null) {	// �엯�옣 �꽦怨듭떆
									ui.setSize(1400, 730);
									ui.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);
									ui.pnMusicChoice = new MusicChoicePanel(ui);
									ui.setTitle("Drop the beat!! - Room");
									ui.setContentPane(ui.pnMusicChoice);
									System.out.println("sendChat �샇異�");
									sendChatRequest("�씠/媛� �엯�옣�뻽�뒿�땲�떎.");
									ui.pnMusicChoice.btReady.setEnabled(true);
									ui.pnMusicChoice.btStart.setEnabled(false);
									ui.pnMusicChoice.btInvite.setEnabled(false);
									ui.pnMusicChoice.btExpel.setEnabled(false);
									ui.pnMusicChoice.lbCrownRight.setIcon(new ImageIcon(getClass().getClassLoader().getResource("clientPanel/imge/crown1.png")));
									ui.pnMusicChoice.tfusernick2.setText(resp.getJoiner().get(0).getNick());
									ui.pnMusicChoice.tfuserinfo2.setText(resp.getJoiner().get(0).tell());
									ui.pnMusicChoice.tfusernick1.setText(resp.getJoiner().get(1).getNick());
									ui.pnMusicChoice.tfuserinfo1.setText(resp.getJoiner().get(1).tell());
									ui.pnMusicChoice.p.leftButton.setEnabled(false);
									ui.pnMusicChoice.p.rightButton.setEnabled(false);
									ui.pnMusicChoice.btRoomSetting.setEnabled(false);
									sendRoomUserInfoRequest();
									ui.pnMusicChoice.p.selectedMusic.close();
									ui.pnMusicChoice.p.nowSelected = resp.getSelectMusic();
									ui.pnMusicChoice.p.selectTrack(resp.getSelectMusic());
									ui.pnMusicChoice.p.isRoomScreen = true;
								 
								}else {
									JOptionPane.showMessageDialog(ui, "鍮꾨�踰덊샇媛� ���졇�뒿�땲�떎.");
								}
							}
						}
				}catch (ClassNotFoundException | IOException e) {
					System.out.println(e.toString());
			}
		}
	}
	
	// 諛� 留뚮뱾湲� 
	public void sendCreateRoomRequest(String title, String pw, boolean twouser) {
		Room resp = null;
		synchronized (oos) {
			try {
				
				oos.writeObject("createroom#" + title + "#" + twouser + "#" + pw);
				resp = (Room) ois.readObject();;
				System.out.println(resp);

				if (resp == null) {
					JOptionPane.showMessageDialog(ui, "�씠誘� 紐⑤뱺 諛⑹씠 �깮�꽦�릺�뼱�엳�뒿�땲�떎.");
				} else if(!twouser){
					ui.setSize(1400, 730);
					ui.pnMusicChoice = new MusicChoicePanel(ui);
					ui.setDefaultCloseOperation(JFrame.DO_NOTHING_ON_CLOSE);
					ui.setTitle("Drop the beat!! - Room(" + title + ")");
					ui.setContentPane(ui.pnMusicChoice);
					ui.pnMusicChoice.btReady.setEnabled(false);
					ui.pnMusicChoice.btStart.setEnabled(true);
					ui.pnMusicChoice.tfusernick1.setText(resp.getJoiner().get(0).getNick());
					ui.pnMusicChoice.tfuserinfo1.setText(resp.getJoiner().get(0).tell());
					ui.pnMusicChoice.tfusernick2.setText("�궗�슜�옄 �뾾�쓬");
					ui.pnMusicChoice.lbCrownLeft.setIcon(new ImageIcon(getClass().getClassLoader().getResource("clientPanel/imge/crown1.png")));
					ui.pnMusicChoice.rightPanel.setVisible(false);
					ui.pnMusicChoice.p.leftButton.setEnabled(true);
					ui.pnMusicChoice.p.rightButton.setEnabled(true);
					ui.pnMusicChoice.btInvite.setEnabled(false);
					ui.pnMusicChoice.p.isRoomScreen = true;
				} else {
					ui.setSize(1400, 730);
					ui.pnMusicChoice = new MusicChoicePanel(ui);
					ui.setTitle("Drop the beat!! - Room(" + title + ")");
					ui.setContentPane(ui.pnMusicChoice);

					ui.pnMusicChoice.btReady.setEnabled(false);
					ui.pnMusicChoice.btStart.setEnabled(false);
					ui.pnMusicChoice.tfusernick1.setText(resp.getJoiner().get(0).getNick());
					ui.pnMusicChoice.tfuserinfo1.setText(resp.getJoiner().get(0).tell());
					ui.pnMusicChoice.tfusernick2.setText("�궗�슜�옄 �뾾�쓬");
					ui.pnMusicChoice.p.leftButton.setEnabled(true);
					ui.pnMusicChoice.p.rightButton.setEnabled(true);
					ui.pnMusicChoice.lbCrownLeft.setIcon(new ImageIcon(getClass().getClassLoader().getResource("clientPanel/imge/crown1.png")));
					ui.pnMusicChoice.btExpel.setEnabled(false);
					ui.pnMusicChoice.p.isRoomScreen = true;
				}
			} catch (ClassNotFoundException | IOException e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 梨꾪똿 蹂대궡湲�
	public void sendChatRequest(String txt) {
		String resp = null;
		synchronized (oos) {
			try {
				oos.writeObject("chat#" + txt);
				ui.pnMusicChoice.txInput.setText("");

			} catch (IOException e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 以�鍮� �긽�깭 蹂대궡湲�
	public void sendReadyRequest() {
		synchronized (oos) {
			try {
				if (ui.pnMusicChoice.btReady.isSelected()) {
					oos.writeObject("ready");
					sendChatRequest("Ready");
				} else {
					oos.writeObject("readycancel");
					sendChatRequest("Ready Cancel");
				}
			} catch (IOException e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 諛� �엯�옣�떆 �긽��諛⑹뿉寃� �젙蹂� 媛깆떊 �슂泥�
	public void sendRoomUserInfoRequest() {
		synchronized (oos) {
			try {
				oos.writeObject("roomuserinfo");
			} catch (IOException e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 寃뚯엫�씠 �걹�굹怨� �쑀�� �젙蹂� 媛깆떊
	public void sendReRoomUserInfoRequest() {
		synchronized (oos) {
			try {
				oos.writeObject("reroomuserinfo");
				Room ac = (Room) ois.readObject();
				if (ac.getJoiner().get(0).getNick().equals(ui.pnMusicChoice.tfusernick1.getText())) {
					ui.pnMusicChoice.tfuserinfo1.setText(ac.getJoiner().get(0).tell());
				} else{
					ui.pnMusicChoice.tfuserinfo1.setText(ac.getJoiner().get(1).tell());
				}
				if (ac.getJoiner().get(0).getNick().equals(ui.pnMusicChoice.tfusernick2.getText())) {
					ui.pnMusicChoice.tfuserinfo2.setText(ac.getJoiner().get(0).tell());
					System.out.println("1 " + ac.getJoiner().get(0).tell());
				} else{
					ui.pnMusicChoice.tfuserinfo2.setText(ac.getJoiner().get(1).tell());
					System.out.println("2 " + ac.getJoiner().get(1).tell());
				}
			} catch (IOException | ClassNotFoundException e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 寃뚯엫 �떆�옉�뻽�쓣 �븣
	public void sendStartGameRequest() {
		int num = ui.pnMusicChoice.p.nowSelected;
		synchronized (oos) {
			try {
				oos.writeObject("startgame#" + num);
			} catch (IOException e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 諛⑹뿉�꽌 �꽑�깮 裕ㅼ쭅 蹂�寃쎌떆
	public void sendChangeMusicRequest(String txt) {
		synchronized (oos) {
			try {
				System.out.println("怨� 諛붾�� 蹂대깂");
				oos.writeObject(txt);
			} catch (IOException e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// �떎�떆媛� �젏�닔 媛깆떊
	public void sendScoreRequest(int score) {
		synchronized (oos) {
			try {
				oos.writeObject("score#" + score);
			} catch (IOException e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 寃뚯엫 寃곌낵 �슂泥�
	public void sendGameResultRequest(int result) {
		synchronized (oos) {
			try {
				oos.writeObject("gameresult#" + result);
			} catch (IOException e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 鍮좊Ⅸ �엯�옣 �슂泥�
	public void sendQuickRoomRequest() {
		synchronized (oos) {
			try {
				oos.writeObject("QuickRoom");
				int resp = (Integer)ois.readObject();
				if(resp<0) {
					JOptionPane.showMessageDialog(ui, "�쁽�옱 李멸��븷 諛⑹씠 �뾾�뒿�땲�떎.");
				} else {
					sendEnterRoomRequest(resp);
				}
			} catch (Exception e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 硫붿꽭吏� 蹂대궡湲� �슂泥�
	public void sendMessageRequest(String name, String ment) {
		synchronized (oos) {
			try {
				oos.writeObject("sendMessage#" + name + "#" + ment);
				
			} catch (Exception e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 硫붿꽭吏� 媛��닔 媛깆떊
	public void sendMessageStateRequest() {
		synchronized (oos) {
			try {
				oos.writeObject("notreadingmessage");
				int l = (Integer)ois.readObject();
				ui.pnRoom.pnInfo.btMessage.setText(String.valueOf(l));
			} catch (Exception e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 硫붿꽭吏� 紐⑸줉 �슂泥�
	public void sendShowMessageListRequest() {
		synchronized (oos) {
			try {
				oos.writeObject("messagelist");
				List<Message> resp = (List<Message>)ois.readObject();
				if(resp != null) {
					String[] ar = new String[resp.size()];
					int i = 0;
					for (Message a : resp) {
						ar[i++] = (a.isRead() ? "�뿃" : "     ") + "  [ " + a.sendToString() + " " + (a.sendToString().equals("�닔�떊") ? "��" : "�뼳") + " ] " + a.getName() + "                                      " + a.getDate();  
						
					}
					ui.m.messageList.setListData(ar);
					
				}
			} catch (Exception e) {
				System.out.println(e.toString());
				System.out.println(e.getStackTrace());
			}
		}
	}
	
	// �씫�� 硫붿꽭吏� �긽�깭 蹂�寃�
	public void sendCheckReadMessageRequest(int idx) {
		synchronized (oos) {
			try {
				oos.writeObject("checkreadmessage#" + idx);
				boolean l = (Boolean)ois.readObject();
				if(l) {
					sendMessageStateRequest();
				}
			} catch (Exception e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// �씫�쓣 硫붿꽭吏� 遺덈윭�샂
	public Message sendShowMessageRequest(int idx) {
		synchronized (oos) {
			try {
				oos.writeObject("readmessage#" + idx);
				Message m = (Message)ois.readObject();
				return m;
			} catch (Exception e) {
				System.out.println(e.toString());
				return null;
			}
		}
	}
	
	// 珥덈� 媛��뒫�븳 �쑀�� 由ъ뒪�듃 �샇異�
	public void sendInviteUserListRequest() {
		synchronized (oos) {
			try {
				oos.writeObject("availableinviteuser");
				List<Account> resp = (List<Account>)ois.readObject();

				InviteUsetListFrame n = new InviteUsetListFrame();
				n.setSize(400, 500);
				n.setLocationRelativeTo(null);
				String[] ar = new String[resp.size()];
				int i = 0;
				for (Account a : resp) {
					ar[i++] = a.toString();
				}
				n.setVisible(true);
				n.userList.setListData(ar);
			} catch (Exception e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// �쑀���뿉寃� 珥덈�硫붿꽭吏� 蹂대궡湲�
	public void sendinviteRequest(String user) {
		synchronized (oos) {
			try {
				oos.writeObject("inviteuser#" + user);
			} catch (Exception e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 媛뺥눜�븯湲�
	public void sendExpelRequest() {
		synchronized (oos) {
			try {
				String name = ui.pnMusicChoice.tfusernick2.getText();
				oos.writeObject("expeluser#" + name);
				ui.pnMusicChoice.txArea.append("[�떆�뒪�뀥] " + name + "�떂�쓣 媛뺥눜�븯���뒿�땲�떎.\n");;
			} catch (Exception e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 1�씤�슜 寃뚯엫 寃곌낵�쟾�떖
	public void sendSingleGameResultRequest(int score) {
		synchronized (oos) {
			try {
				oos.writeObject("singlegameresult#" + score);
				Account b = (Account)ois.readObject();
				if(b!=null) {
					ui.pnMusicChoice.tfuserinfo1.setText(b.tell());
				} 
			} catch (Exception e) {
				System.out.println(e.toString());
			}
		}
	}
	
	// 諛� �꽕�젙 蹂�寃� �슂泥�
	public void sendChangeRoomSettingRequest(String title, String pw, boolean twouser) {
		synchronized (oos) {
			try {
				oos.writeObject("changeroomsetting#" + title + "#" + twouser + "#" + pw);
				if(twouser) {
					ui.pnMusicChoice.btReady.setEnabled(false);
					ui.pnMusicChoice.btStart.setEnabled(false);
					ui.pnMusicChoice.btInvite.setEnabled(true);
					ui.pnMusicChoice.rightPanel.setVisible(true);
					ui.setTitle("Drop the beat!! - Room(" + title + ")");
				} else {
					ui.pnMusicChoice.btReady.setEnabled(false);
					ui.pnMusicChoice.btStart.setEnabled(true);
					ui.pnMusicChoice.btInvite.setEnabled(false);
					ui.pnMusicChoice.rightPanel.setVisible(false);
					ui.setTitle("Drop the beat!! - Room(" + title + ")");
				}
			} catch (Exception e) {
				System.out.println(e.toString());
			}
		}
	}
	
}